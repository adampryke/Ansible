---
- name: Update Windows devices
  hosts: windows
  gather_facts: false
  ansible_connection: winrm
  tasks:
  - name: Install all Windows updates
    win_updates:
      category_names:
        - CriticalUpdates
        - SecurityUpdates
      state: installed
      reboot: false
    register: win_updates_result
  - name: Reboot if required
    win_reboot:
    when: win_updates_result.reboot_required
